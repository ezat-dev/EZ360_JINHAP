<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="condition">
	<!--기준정보 -->
	<select id="getStandardInfoList" parameterType="condition" resultType="condition">
		 SELECT *
		    FROM PWO_GEO_DIVISION_DATA
		    
		    <where>
		        <if test="coating_nm != null and coating_nm != ''">
	            	AND COATING_NM LIKE '%'||#{coating_nm}||'%'
		        </if>
		    
		    
		    	<if test="group_id != null and group_id != ''">
	            	AND GROUP_ID LIKE '%'||#{group_id}||'%'
		        </if>
		        <if test="item_cd != null and item_cd != ''">
		            AND ITEM_CD LIKE '%'||#{item_cd}||'%'
		        </if>
		        <if test="item_nm != null and item_nm != ''">
		            AND ITEM_NM LIKE '%'||#{item_nm}||'%'
		        </if>
		        

	    </where>
	</select>
    
<insert id="saveDivisionWeight" parameterType="Condition">
  MERGE INTO PWO_GEO_DIVISION_DATA
  USING DUAL
  ON (
    ITEM_CD = #{item_cd}
  )
  WHEN MATCHED THEN
  UPDATE SET 
    group_id = #{group_id},
    item_nm = #{item_nm},
    mach_main = #{mach_main},
    mach_main_weight = #{mach_main_weight},   
    mach_sub = #{mach_sub},
    mach_sub_weight = #{mach_sub_weight},
    mlpl_weight = #{mlpl_weight},
    coating_nm = #{coating_nm},
    kblack_weight = #{kblack_weight},
    user_id = #{user_id},
    upd_dt = #{upd_dt}
  WHEN NOT MATCHED THEN
  INSERT (
    plac_cd, plnt_cd, group_id, item_cd, item_nm,
    mach_main, mach_main_weight, mach_sub, mach_sub_weight,
    mlpl_weight, coating_nm, kblack_weight,
    user_id, upd_dt
  )
  VALUES (
    #{plac_cd}, #{plnt_cd}, #{group_id}, #{item_cd}, #{item_nm},
    #{mach_main}, #{mach_main_weight}, #{mach_sub}, #{mach_sub_weight},
    #{mlpl_weight}, #{coating_nm}, #{kblack_weight},
    #{user_id}, #{upd_dt}
  )
</insert>


    
        <delete id="delDivisionWeight" parameterType="string">
        DELETE FROM PWO_GEO_DIVISION_DATA 
        WHERE item_cd = #{item_cd}
    	</delete>
    
    
    
    <!--TC조절  -->
    
<select id="getCorrStatusList" parameterType="map" resultType="Condition">
    SELECT *
    FROM tb_corr_status
    <where>
        <if test="equipment_name != null and equipment_name != ''">
            AND equipment_name = #{equipment_name}
        </if>

        <if test="startDate != null and startDate != ''">
            AND replacement_date <![CDATA[>=]]> #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND replacement_date <![CDATA[<=]]> #{endDate}
        </if>
    </where>
    ORDER BY 
        FIELD(equipment_name,
            '세척 1호기',
            '세척 2호기',
            '세척 공통 (열병합)',
            '이코팅1호기',
            '이코팅2호기',
            'G600',
            'G800',
            'K-BLACK',
            '공용설비',
            '방청'
        ),
        tdatetime DESC
</select>

        <delete id="delCorrStatus" parameterType="string">
        DELETE FROM tb_corr_status 
        WHERE no = #{no}
    	</delete>
    	
    	
	<update id="saveCorrStatus" parameterType="corrStatus">
	    UPDATE tb_corr_status
	    SET
	        equipment_name = #{equipment_name},
	        location = #{location},
	        serial_number = #{serial_number},
	        replacement_date = #{replacement_date},
	        next_date = #{next_date},
	        replacement_cycle = #{replacement_cycle},
	        remarks = #{remarks}
	    WHERE no = #{no}
	</update>
	
   <!--조건관리  -->
   <select id="getconditionList" parameterType="Condition" resultType="Condition">
    SELECT *
    FROM tb_part_temp
    WHERE 1 = 1
    <if test="startDate != null and startDate != ''">
        AND `date` LIKE CONCAT(#{startDate}, '%')
    </if>
    <if test="mch_code != null and mch_code != ''">
        AND mch_code = #{mch_code}
    </if>
        <if test="p_code != null and p_code != ''">
        AND p_code = #{p_code}
    </if>
   </select>
   
	
	
<update id="machinePartTempUpdate" parameterType="Condition">
    UPDATE tb_part_temp 
    <set>
        <if test="filed == 'specific_gravity'">specific_gravity = #{value},</if>
        <if test="filed == 'visocosity'">visocosity = #{value},</if>
        <if test="filed == 'tank_temp'">tank_temp = #{value},</if>
        <if test="filed == 'chiller_temp'">chiller_temp = #{value},</if>
        <if test="filed == 'specific_gravity1'">specific_gravity1 = #{value},</if>
		<if test="filed == 'visocosity1'">visocosity1 = #{value},</if>
    </set>
    WHERE id = #{id}
</update>









<select id="getMachineliquidmanage" parameterType="Condition" resultType="Condition">
    SELECT *
    FROM tb_machineliquidmanage
    WHERE 1 = 1
    <if test="mch_name != null and mch_name != ''">
        AND mch_name = #{mch_name}
    </if>
      <!-- 날짜 필터 -->
  <choose>
    <!-- 시작+종료 모두 있는 경우: [in_date, end_date+1day) -->
    <when test="in_date != null and in_date != '' and endDate != null and endDate != ''">
      AND in_date &gt;= #{in_date}
      AND in_date &lt; DATE_ADD(#{endDate}, INTERVAL 1 DAY)
    </when>

    <!-- 시작만 있는 경우: 해당 일 하루 -->
    <when test="endDate != null and endDate != ''">
      AND in_date &gt;= #{in_date}
      AND in_date &lt; DATE_ADD(#{in_date}, INTERVAL 1 DAY)
    </when>

    <!-- 종료만 있는 경우: 그 날까지 -->
    <when test="endDate != null and endDate != ''">
      AND in_date &lt; DATE_ADD(#{end_date}, INTERVAL 1 DAY)
    </when>
    <!-- 둘 다 없는 경우: 필터 없음 -->
    <otherwise/>
  </choose>
  order by in_date desc
</select>

<insert id="insertMachineliquidmanage" parameterType="Condition">
  INSERT INTO tb_machineliquidmanage (
 	id,
    mch_name,
    in_date,
    m68_mixer_no,
    m68_g1_temp,
    m68_g2_temp,
    m68_g1_lot_no,
    m68_g2_lot_no,
    m68_thickener_time,
    m68_thickener_g,
    m68_thickener_lot,
    m68_post_rpm,
    m68_mixing_start_time,
    m68_mixing_time,
    m68_checker,
    m68_mch_temp,
    m68_humidity,
    m68_viscosity,
    m68_out_time,
    kmp_humidity,
    kmp_mixing_temp,
    kmp_mch_temp,
    kmp_liquid_lot_no,
    kmp_mixing_start_time,
    kmp_mixing_time,
    kmp_mch_visc,
    kmp_out_time,
    kmp_checker,
    rpm
  )
  VALUES (
 	#{id},
    #{mch_name},
    #{in_date},
    #{m68_mixer_no},
    #{m68_g1_temp},
    #{m68_g2_temp},
    #{m68_g1_lot_no},
    #{m68_g2_lot_no},
    #{m68_thickener_time},
    #{m68_thickener_g},
    #{m68_thickener_lot},
    #{m68_post_rpm},
    #{m68_mixing_start_time},
    #{m68_mixing_time},
    #{m68_checker},
    #{m68_mch_temp},
    #{m68_humidity},
    #{m68_viscosity},
    #{m68_out_time},
    #{kmp_humidity},
    #{kmp_mixing_temp},
    #{kmp_mch_temp},
    #{kmp_liquid_lot_no},
    #{kmp_mixing_start_time},
    #{kmp_mixing_time},
    #{kmp_mch_visc},
    #{kmp_out_time},
    #{kmp_checker},
    #{rpm}
  )
  ON DUPLICATE KEY UPDATE
    in_date = VALUES(in_date),
    mch_name = VALUES(mch_name),
    m68_mixer_no = VALUES(m68_mixer_no),
    m68_g1_temp = VALUES(m68_g1_temp),
    m68_g2_temp = VALUES(m68_g2_temp),
    m68_g1_lot_no = VALUES(m68_g1_lot_no),
    m68_g2_lot_no = VALUES(m68_g2_lot_no),
    m68_thickener_time = VALUES(m68_thickener_time),
    m68_thickener_g = VALUES(m68_thickener_g),
    m68_thickener_lot = VALUES(m68_thickener_lot),
    m68_post_rpm = VALUES(m68_post_rpm),
    m68_mixing_start_time = VALUES(m68_mixing_start_time),
    m68_mixing_time = VALUES(m68_mixing_time),
    m68_checker = VALUES(m68_checker),
    m68_mch_temp = VALUES(m68_mch_temp),
    m68_humidity = VALUES(m68_humidity),
    m68_viscosity = VALUES(m68_viscosity),
    m68_out_time = VALUES(m68_out_time),
    kmp_humidity = VALUES(kmp_humidity),
    kmp_mixing_temp = VALUES(kmp_mixing_temp),
    kmp_mch_temp = VALUES(kmp_mch_temp),
    kmp_liquid_lot_no = VALUES(kmp_liquid_lot_no),
    kmp_mixing_start_time = VALUES(kmp_mixing_start_time),
    kmp_mixing_time = VALUES(kmp_mixing_time),
    kmp_mch_visc = VALUES(kmp_mch_visc),
    kmp_out_time = VALUES(kmp_out_time),
    kmp_checker = VALUES(kmp_checker),
    rpm = VALUES(rpm)
</insert>

	
	
	

<select id="getMachineliquidmanage2" parameterType="Condition" resultType="Condition">
    SELECT *
    FROM tb_machineliquidmanage_2
    WHERE 1=1
    <if test="mch_name != null and mch_name != ''">
        AND mch_name = #{mch_name}
    </if>
  <choose>
    <!-- 시작+종료 모두 있는 경우: [in_date, end_date+1day) -->
    <when test="in_date != null and in_date != '' and endDate != null and endDate != ''">
      AND in_date &gt;= #{in_date}
      AND in_date &lt; DATE_ADD(#{endDate}, INTERVAL 1 DAY)
    </when>

    <!-- 시작만 있는 경우: 해당 일 하루 -->
    <when test="endDate != null and endDate != ''">
      AND in_date &gt;= #{in_date}
      AND in_date &lt; DATE_ADD(#{in_date}, INTERVAL 1 DAY)
    </when>

    <!-- 종료만 있는 경우: 그 날까지 -->
    <when test="endDate != null and endDate != ''">
      AND in_date &lt; DATE_ADD(#{endDate}, INTERVAL 1 DAY)
    </when>

    <!-- 둘 다 없는 경우: 필터 없음 -->
    <otherwise/>
  </choose>
    ORDER BY in_date DESC
</select>

<!-- insert 매퍼: id 제외 -->
<insert id="insertMachineliquidmanage2" parameterType="Condition">
    INSERT INTO tb_machineliquidmanage_2 (
        id,
        mch_name,
        in_date,
        tank_no,
        ck_time,
        liquid_lot_no,
        liquid_in,
        distilles_in,
        liquid_viscosity,
        specific_gravity,
        viscosity_after,
        ck_time2,
        operator
    )
    VALUES (
        #{id},
        #{mch_name},
        #{in_date},
        #{tank_no},
        #{ck_time},
        #{liquid_lot_no},
        #{liquid_in},
        #{distilles_in},
        #{liquid_viscosity},
        #{specific_gravity},
        #{viscosity_after},
        #{ck_time2},
        #{operator}
    )
    ON DUPLICATE KEY UPDATE
        mch_name = VALUES(mch_name),
        in_date = VALUES(in_date),
        tank_no = VALUES(tank_no),
        ck_time = VALUES(ck_time),
        liquid_lot_no = VALUES(liquid_lot_no),
        liquid_in = VALUES(liquid_in),
        distilles_in = VALUES(distilles_in),
        liquid_viscosity = VALUES(liquid_viscosity),
        specific_gravity = VALUES(specific_gravity),
        viscosity_after = VALUES(viscosity_after),
        ck_time2 = VALUES(ck_time2),
        operator = VALUES(operator)
</insert>



<delete id="deleteMachineliquidmanage" parameterType="int">
    DELETE FROM tb_machineliquidmanage
    WHERE id = #{id}
</delete>
<delete id="deleteMachineliquidmanage2" parameterType="int">
    DELETE FROM tb_machineliquidmanage_2
    WHERE id = #{id}
</delete>



  <!-- 리스트 조회 -->
  <select id="divisionWashingList"
          parameterType="Condition"
          resultType="Condition">
    SELECT
      option01,
      code_name,
      option02,
      option03,
      option04,
      option05,
      (
        SELECT SUM(NVL(TO_NUMBER(option03), 0))
        FROM pwo_bas_cd
        WHERE GROUP_CODE = 'EZ001'
      ) AS sum_val
    FROM PWO_BAS_CD
    WHERE GROUP_CODE = 'EZ001'
  </select>

  <!-- 업데이트 -->
<update id="divisionWashingUpdate"
        parameterType="Condition">
  UPDATE PWO_BAS_CD
  SET
    option02 = #{option02, jdbcType=VARCHAR},
    option03 = #{option03, jdbcType=VARCHAR},
    option04 = #{option04, jdbcType=VARCHAR},
    option05 = #{option05, jdbcType=VARCHAR}
  WHERE
    GROUP_CODE = 'EZ001'
    AND code_name = #{code_name, jdbcType=VARCHAR}
</update>

<insert id="divisionWashingLog" parameterType="Condition">
    INSERT INTO divisionwashing_log (
        code_name,
        option02,
        option03,
        option04,
        option05,
        op2_old,
        op3_old,
        op4_old,
        op5_old,
        user_id,
        upd_dt,
        log_dt
    )
    VALUES (
        #{code_name},
        #{option02},
        #{option03},
        #{option04},
        #{option05},
        #{op2_old},
        #{op3_old},
        #{op4_old},
        #{op5_old},
        #{user_id},
        #{upd_dt},
        NOW()
    )
</insert>


<select id="divisionWashingLogList" parameterType="Condition" resultType="Condition">
    SELECT 
        id,
        code_name,
        option02,
        option03,
        option04,        
        option05,
        CASE 
            WHEN op2_old IS NULL THEN '""'
            ELSE op2_old
        END AS op2_old,
        CASE 
            WHEN op3_old IS NULL THEN '""'
            ELSE op3_old
        END AS op3_old,
         CASE 
            WHEN op4_old IS NULL THEN '""'
            ELSE op4_old
        END AS op4_old,
        CASE 
            WHEN op5_old IS NULL THEN '""'
            ELSE op5_old
        END AS op5_old,
        user_id,
        upd_dt,
        log_dt
    FROM 
        divisionwashing_log
    ORDER BY log_dt DESC
</select>


<select id="dailyCheckList" parameterType="Condition" resultType="Condition">
    SELECT 
        D.MAINT_DATE            AS maint_date,          -- 등록일자
        C.SEGMENT_ID            AS segment_id,          -- 공정명
        D.EQUIPMENT_ID          AS equipment_id,        -- 설비명
        C.MAINT_ITEM_NAME_KO_KR AS maint_item_name_ko_kr, -- 점검항목
        ''                      AS ss,                  -- 방법
        C.MAINT_TARGET          AS maint_target,        -- 기준값
        C.MAINT_USL             AS maint_usl,           -- 상한값
        C.MAINT_LSL             AS maint_lsl,           -- 하한값
        D.MAINT_VALUE           AS maint_value,         -- 측정값
        D.RESULT                AS d_result,            -- D 결과
        E.RESULT                AS e_result             -- E 결과
    FROM EXT_EMS_TB_DAILY_MAINT_ITEM C
    INNER JOIN EXT_EMS_TB_DAILY_MAINT_ITEM_RESULT D
        ON C.MAINT_ITEM_ID = D.MAINT_ITEM_ID
    INNER JOIN EXT_EMS_TB_DAILY_MAINT_RESULT E
        ON D.EQUIPMENT_ID = E.EQUIPMENT_ID
       AND D.MAINT_DATE = E.MAINT_DATE
       AND D.DAY_NIGHT = E.DAY_NIGHT
    WHERE 1=1
      AND D.MAINT_DATE <![CDATA[ >= ]]> #{s_time}
      AND D.MAINT_DATE <![CDATA[ <= ]]> #{e_time}
      AND D.EQUIPMENT_ID = #{m_code}
    ORDER BY D.MAINT_DATE DESC
</select>




	
</mapper>